<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <title>EMG mouse tool</title>
</head>
<body>
<canvas id="canvas" width="600" height="900" />
<script>


const canvas = document.getElementById ("canvas");
const context = canvas.getContext ("2d");

      function update_canvas(data) {
        context.clearRect (0, 0, canvas.width, canvas.height);
        context.strokeStyle = "1px solid black";
        context.beginPath();
        data.history.forEach((value, index) => {
          const x = index * 600 / data.history.length;
          const y = value * 900;
          if (index == 0) {
            context.moveTo(x,y)
             } else {
              context.lineTo(x,y);
              }
        });
        context.stroke();

      }

      async function frame() {
          try {
            const response = await fetch ("/state_update", {
              method: "POST",
            });
            if (response.ok) {
              const data = await response.json();
              if (data !== null) {
                update_canvas(data);
              }
            }
          }
          finally {
            requestAnimationFrame (frame);
          }
      }

      frame();



    </script>
</body>
</html>